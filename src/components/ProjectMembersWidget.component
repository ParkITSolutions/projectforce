<apex:component controller="ProjectMembersWidgetController" allowDml="true">
	<!-- Attribute Definitions -->
	<apex:attribute name="projectId" description="The project ID" type="String" required="true" assignTo="{!team}" />
	<apex:attribute name="type" description="The list type" type="String" required="false" assignTo="{!typeList}" />

	<!-- ### JavaScript ### -->
	<script src="{!URLFOR($Resource.ProjectResources, 'inc/js/autocomplete.js')}" />
	
	<apex:stylesheet value="{!URLFOR($Resource.commonResources, 'inc/css/teamMembersWidget.css')}" />
	<apex:includeScript value="{!URLFOR($Resource.commonResources, 'inc/js/teamMembersWidget.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.ProjectResources, 'inc/js/TeamsWidgetCommon.js')}" />

	<!-- Common CSS Styling  -->
	<apex:stylesheet value="{!URLFOR($Resource.PeopleResourceFiles, 'inc/css/autocomplete.css')}"/>
	<apex:stylesheet value="{!URLFOR($Resource.ProjectResources, 'inc/css/teamOverlyInviteNewMember.css')}" />

	<script>
		/**
        * Namespace Prefix Getter
        */
        var namespace = "{!namespace}";		
	
		var API_SESSION_ID = "{!$Api.Session_ID}";
		var rootResource = "{!URLFOR($Resource.ProjectResources)}";	
		
		var globalTeamLabel = "{!$ObjectType.Project2__c.label}";		
		var globalCollaguesNames = "{!$Component.colleaguesNames}";
		var globalNewTeamProfile = "{!$Component.newTeamProfile}";
		var globalUnknownTeam = "{!URLFOR($Resource.commonResources, 'images/placeholders/unknowteam_big.gif')}";
		var globalListToolkitCount = {!memberListToolkitCount};
		var globalUserNotPicture= "{!URLFOR($Resource.ProjectResources, 'images/layout/icons/user_not_picture.gif')}";
		
		var teamIDActive = '{!team}';
		var currentUser = '{!currentUser}';
		
		var myTeamId = "{!teamId}";
		var myMembersIds = "{!TeamspaceMembersIds}";
		var firstExecuteTime = true;
		
		function ifInPrjDetail(){
		
			if( location.href.include( 'projectDetail' ))
			refreshAssignToTask();
		}
	</script>
	
	<style>
		.name_error {
			color: #FF0000;
		}
	</style>

	<!-- NEW MEMBER OVERLAY -->
	<apex:outputpanel rendered="{!IF(isManager, true, false)}" >

		<!-- Content  -->
		<div id="inviteTeam" style="display: none;" class="overlayForm">
		<div class="swirly_overlay" style="display: none;"></div>
		<!-- Overlay Title -->
		<div class="overlayTitleContent">
		<div class="overlayTitle">Add new member to <script>trunkText('{!teamName}',24);</script></div>
		<div class="overlayCloseEvent"><a href="Javascript:;"
			onclick="modal.close();"> <img
			src="{!URLFOR($Resource.ProjectResources, 'images/layout/genericClose.gif')}"
			alt="Close Window" title="Close Window" /> </a></div>
		</div>
		<div class="overlayMainContent"><!-- Required Information --> 
			<span class="overlayRequiredInfo">= Required Information</span> 
				<apex:form id="newMemberForm"
					onSubmit="if(validateColleguesInput()){showSwirly('swirly_overlay'); Form.disable(this.id);} else return false;">
					<div class="overlayFormContent">
					<table cellpadding="0" cellspacing="0"
						style="margin: 0px; padding: 0px; width: 100%;">
						<tr>
							<td class="inputInfoTitle"><span class="inputInfoTitle">Add
							colleagues</span><br />
							<span class="explainBottom">(enter name or email)</span></td>
							<td style="width: 4px;"><span
								style="display: block; width: 4px; height: 67px; background-color: #C0272D;"></span>
							</td>
							<td>
							<div id="ajaxResult" style="display: none;"></div>
							&nbsp; <apex:inputTextArea id="colleaguesNames"
										styleClass="colleaguesNames" style="width:310px; height:63px;"
										value="{!newMemberVars.colleagueNames}"
										onFocus="var options = {script: function (input) {return ('SuggestDispatcher?input='+input+'&class=colleagueNames&teamId={!teamId}');}};xml = new AutoComplete('{!$Component.colleaguesNames}',options);return true" 
										onBlur="javascript: hideSuggest();" />
							</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td>&nbsp;<span class="explain">(comma separated)</span> <br />
							</td>
						</tr>
						<tr>
							<td height="10px"></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td height="10px">
								<apex:inputCheckBox value="{!emailNotifications}" id="emailNotifications"/>
								<span class="inputInfoTitle">Email notifications </span>
							</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td height="10px">
								<apex:inputCheckBox value="{!isAdministrator}" id="makeAdministrators"/>
								<span class="inputInfoTitle">Make Members Administrators</span>
							</td>
						</tr>
						<tr>
							<td height="15px"></td>
						</tr>
					</table>
					</div>
					<div id="paginationLittleOverlay" style="display: none;">
					<div class="loader"><img
						src="{!URLFOR($Resource.commonResources, 'images/loaders/big-loader.gif')}"
						alt="Loading..." title="Loading..." /></div>
					</div>
					<div class="overlaySeparateLine"></div>
					
					<!-- Save and Cancel Buttons -->
					<div class="overlayFromButtons" align="center">
						<apex:commandButton action="{!saveMembers}" 
							oncomplete="showMessageToUser('Member has been added to this project','success');addMemberCallBackFunction();setTimeout('Effect.Fade(\'infoToUser\')', 6500);"
							styleclass="btn allButtons" 
							style="float: none;width: 70px !important;background: #21637D none repeat scroll 0 0 !important;" 
							value="Send"
							rerender="membersListContainer" /> 
						<input id="cancelBtn" class="allButtons" type="button" value="Cancel" onclick="modal.close();stopFunction();" />
					</div>
				</apex:form>
			</div>
		</div>
	</apex:outputpanel>
	<!-- On Hover Bubble team member -->
	<div id="bubble" class="bubble" style="display: none">
		<div class="top_border">&nbsp;</div>
		<div class="content"><img class="arrowBubble"
			src="{!URLFOR($Resource.ProjectResources, '/images/layout/bubbles/arrow.gif')}" />
		<!-- Content here -->
		<div class="innerContBubble"
			onmouseover="clearTimeout(hideBubbleTimeout);"
			onmouseout="setTimeoutToHide();">
		<div class="bubbleOverlay" style="display: none;" id="bubbleOverlay">
		<div class="swirl blue"><img
			src="{!URLFOR($Resource.ProjectResources, '/images/layout/small_loader.gif')}" />
		Loading.....</div>
		</div>
		<div class="topLink" id="bubbleTopLink"></div>
		<div class="memberHeader" id="memberInfo">
		<div class="img_holder"></div>
		<div class="memberInfo"></div>
		</div>
		<div class="contact_info" id="contact_info">
		<div class="contact_info_title">Contact Info</div>
		<div class="contact_info_desc">
		<div class="c_email f_left"></div>
		<div class="c_YIM f_right"></div>
		<div class="clear"></div>
		<div class="c_phone f_left"></div>
		<div class="c_skype f_right"></div>
		</div>
		</div>
		<div class="recent_activity" id='recent_activity_desc'></div>
		</div>
		<!-- End Content here --></div>
		<div class="bottom_border">&nbsp;</div>
	</div>
	<!-- On Hover Bubble Team member -->
	<!-- Team Details Widget -->
	<div class="teamWidget mySmallWidget" id="teamMemberID">
		<!-- Widget Title -->
		<div class="thinHeader"><apex:outputpanel rendered="{!(ComponentHeader!='Team Admins')}">
			<div>
				<div>
					<h4>{!$ObjectType.Project2__c.label} Members</h4>
				</div>
			</div>
			</apex:outputpanel> <apex:outputpanel rendered="{!(ComponentHeader=='Team Admins')}">
				<div>
					<div>
						<h4>{!$ObjectType.Project2__c.label} Admins</h4>
					</div>
				</div>
			</apex:outputpanel>
		</div>
		<!-- Widget Container -->
		<div class="box_content">
			<div class="swirly_members" id="swirly_members" style="display: none;"></div>
			<div class="thinBodyFixed thinBody" id="thinBody">
				<div class="contentHolder">
					<div class="linkAction" >
						<apex:outputpanel rendered="{!userPermissions.canManage}">
							<a onclick="createOverlay('','inviteTeam','280','selectFixIE6();startFunction();relocateOverlay()');" href="javascript:;">New</a> |
						</apex:outputpanel>
						<a href="/apex/ProjectMembersList?id={!team}#" class="topRightLinks">See More&#187;</a>
					</div>
				</div>
	  			<apex:outputPanel layout="block" id="membersListContainer">
					
					<!-- AuxPanel - When 'add member' poller finish reload member list. -->
					<apex:outputpanel id="auxPanel">
						<script>
							var remaingToSave = '{!initAddMembers}';
							if (remaingToSave == 'false' && !firstExecuteTime){
								reloadMemberList();
								refreshSwirly();
							}
							
							//Flag for don't execute on load default value is true
							firstExecuteTime = false;
						</script>
					</apex:outputpanel>					
					
					<!-- Sync Save Members -->
					<apex:form >
						<apex:actionPoller action="{!syncSaveMembers}"
							enabled="{!initAddMembers}"
							rerender="auxPanel, membersListContainer, thisForm" interval="5"
							onComplete="refreshCount();" />
						
						<!-- Action Function for Refresh Member List -->
						<apex:actionFunction name="rerenderMemberList"
							action="{!refreshMethod}" rerender="membersListContainer" />
					</apex:form>
					
					<!-- Members Repeat -->
					<apex:repeat value="{!TeamspaceMembers}" var="tm" id="repMembers">
						<div id="memberRow-{!tm.Id}" style="clear: both;">
							<apex:outputPanel layout="block"
								onmouseover="showBubbleMatrixPreload('member',this,'{!tm.Id}');"
								style="clear:both;position:relative;display:block;">
								<apex:outputPanel layout="block" styleClass="membersImageHolder"
									rendered="{!IF(LEN(tm.image) == 0, true, false)}">
									<a href="/{!tm.Id}"> <apex:image width="25" height="25"
										url="{!URLFOR($Resource.ProjectResources, 'images/layout/icons/no_image_small.gif')}"
										style="vertical-align:middle;" /> </a>
								</apex:outputPanel>
								<apex:outputPanel layout="block" styleClass="membersImageHolder"
									rendered="{!IF(LEN(tm.image) == 0, false, true)}">
									<a href="PeopleProfileDisplay?id={!tm.Id}"> <apex:image width="25" height="25"
										url="/servlet/servlet.FileDownload?file={!tm.image}" /> </a>
								</apex:outputPanel>
								<apex:outputPanel layout="block" styleClass="membersDescription" style="float:left;width:120px;">
									<a href="/{!tm.Id}" style="text-decoration: none;"> 
										<apex:outputText value="{!tm.Username}"></apex:outputText> 
									</a>
								</apex:outputPanel>
							</apex:outputPanel> 
							<apex:outputPanel layout="block" styleClass="clear"></apex:outputPanel>
						</div>
					</apex:repeat>
				</apex:outputPanel>
			</div>
		</div> 
		<!-- Widget Holder Foot -->
		<div class="bottom_borders">
			<div>
				<div></div>
			</div>
		</div>
	</div>
	<div class="clear"></div>
	<script>
		function addMemberCallBackFunction(){
			setTimeout('modal.close(); hideSwirly(\'swirly_overlay\')', 5000);

			if( window.location.href.include('MembersList')){
				$('paginationOverlay').show(); 
				setDims('holder','paginationOverlay');
			}
			
			$$( '.swirly_members' )[ 0 ].show();
			setDims( 'thinBody', $$( '.swirly_members' )[ 0 ].id );
		}
		
	</script>
</apex:component>